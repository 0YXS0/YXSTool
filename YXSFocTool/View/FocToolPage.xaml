<UserControl
  x:Class="YXSFocTool.FocToolPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:ikw="http://schemas.inkore.net/lib/ui/wpf"
  xmlns:local="clr-namespace:YXSFocTool"
  xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
  xmlns:vm="clr-namespace:YXSFocTool.ViewModel"
  d:DataContext="{d:DesignInstance Type=vm:FocToolViewModel}"
  d:Height="600"
  d:Width="1024"
  Background="White"
  FontSize="16"
  mc:Ignorable="d">
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ui:ThemeResources />
        <ui:XamlControlsResources />
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </UserControl.Resources>
  <Grid>
    <!--  主布局：上方内容区 + 下方状态栏  -->
    <Grid.RowDefinitions>
      <RowDefinition Height="*" />
      <RowDefinition Height="24" />
    </Grid.RowDefinitions>

    <!--  内容区：左侧功能区 + 右侧图表区  -->
    <Grid Grid.Row="0">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="260" MinWidth="260" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <!--  左侧功能区  -->
      <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
        <ikw:SimpleStackPanel Margin="4" Orientation="Vertical">
          <!--  连接参数  -->
          <Border BorderBrush="#33000000" BorderThickness="1" CornerRadius="4">
            <Expander
              Margin="4,0,0,0"
              HorizontalAlignment="Stretch"
              ExpandDirection="Down"
              IsExpanded="True">
              <Expander.Header>
                <Label Content="连接设置:" FontSize="20" />
              </Expander.Header>
              <Expander.Content>
                <ikw:SimpleStackPanel Margin="4,0,2,2" Orientation="Vertical">
                  <ToggleButton HorizontalAlignment="Stretch" Content="开启连接" IsChecked="{Binding IsConnected, Mode=TwoWay}" />
                  <Grid Margin="8,2,0,0">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                      Grid.Column="0"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"
                      Text="串口号:" />
                    <ComboBox
                      Grid.Column="1"
                      HorizontalAlignment="Stretch"
                      ItemsSource="{Binding SerialPortList}"
                      SelectedIndex="{Binding SelectedSerialPortIndex, Mode=TwoWay}" />
                  </Grid>
                  <Grid Margin="8,2,0,0">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                      Grid.Column="0"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"
                      Text="波特率:" />
                    <ComboBox
                      Grid.Column="1"
                      HorizontalAlignment="Stretch"
                      IsEditable="True"
                      ItemsSource="{Binding BaudRateList}"
                      SelectedIndex="{Binding SelectedBaudRateIndex, Mode=TwoWay}" />
                  </Grid>
                  <Grid Margin="8,2,0,0">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                      Grid.Column="0"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"
                      Text="设备ID:" />
                    <ComboBox
                      Grid.Column="1"
                      HorizontalAlignment="Stretch"
                      ItemsSource="{Binding DeviceIDList}"
                      SelectedIndex="{Binding SelectedDeviceIDIndex, Mode=TwoWay}" />
                  </Grid>
                </ikw:SimpleStackPanel>
              </Expander.Content>
            </Expander>
          </Border>

          <!--  固件信息  -->
          <Border
            Margin="0,2,0,0"
            BorderBrush="#33000000"
            BorderThickness="1"
            CornerRadius="4">
            <Expander Margin="4,0,0,0" HorizontalAlignment="Stretch" ExpandDirection="Down">
              <Expander.Header>
                <Label Content="固件信息:" FontSize="20" />
              </Expander.Header>
              <Expander.Content>
                <ikw:SimpleStackPanel Margin="8,0,2,0" IsEnabled="True">
                  <!--  bootloader  -->
                  <Border BorderBrush="#33000000" BorderThickness="1" CornerRadius="4">
                    <ikw:SimpleStackPanel Margin="2,0,0,0">
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="Auto" />
                          <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                          Grid.Column="0"
                          Margin="0,0,8,0"
                          VerticalAlignment="Center"
                          Text="Bootloader版本:" />
                        <TextBlock
                          Grid.Column="1"
                          Margin="0,2,0,2"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Center"
                          Text="{Binding BootloaderVersion, Mode=OneWay}" />
                      </Grid>
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Border
                          Grid.Column="0"
                          Margin="0,0,2,0"
                          BorderBrush="#33000000"
                          BorderThickness="1"
                          CornerRadius="4">
                          <Grid>
                            <Grid.ColumnDefinitions>
                              <ColumnDefinition Width="*" />
                              <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                              Grid.Row="0"
                              Grid.Column="0"
                              Margin="8,2"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              FontSize="12"
                              Foreground="Gray"
                              Text="{Binding BootloaderFileName, Mode=OneWay}" />
                            <Button Grid.Column="1" Command="{Binding SelectBootloaderFileCommand}" Content="浏览" />
                          </Grid>
                        </Border>
                        <Button
                          Grid.Row="0"
                          Grid.Column="1"
                          Command="{Binding UpdateBootloaderCommand}"
                          Content="更新" />
                      </Grid>
                      <ui:ProgressBar
                        Grid.Row="1"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Margin="0,2,2,2"
                        Value="{Binding BootloaderUpdateProgress, Mode=OneWay}" />
                    </ikw:SimpleStackPanel>
                  </Border>

                  <!--  固件  -->
                  <Border
                    Margin="0,2,0,0"
                    BorderBrush="#33000000"
                    BorderThickness="1"
                    CornerRadius="4">
                    <ikw:SimpleStackPanel Margin="2,0,0,0">
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="Auto" />
                          <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                          Grid.Column="0"
                          Margin="0,0,8,0"
                          VerticalAlignment="Center"
                          Text="Framware版本:" />
                        <TextBlock
                          Grid.Column="1"
                          Margin="0,2,0,2"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Center"
                          Text="{Binding FirmwareVersion, Mode=OneWay}" />
                      </Grid>
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Border
                          Grid.Column="0"
                          Margin="0,0,2,0"
                          BorderBrush="#33000000"
                          BorderThickness="1"
                          CornerRadius="4">
                          <Grid>
                            <Grid.ColumnDefinitions>
                              <ColumnDefinition Width="*" />
                              <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                              Grid.Row="0"
                              Grid.Column="0"
                              Margin="8,2"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              FontSize="12"
                              Foreground="Gray"
                              Text="{Binding FirmwareFileName, Mode=OneWay}" />
                            <Button Grid.Column="1" Command="{Binding SelectFirmwareFileCommand}" Content="浏览" />
                          </Grid>
                        </Border>
                        <Button
                          Grid.Row="0"
                          Grid.Column="1"
                          Command="{Binding UpdateFirmloaderCommand}"
                          Content="更新" />
                      </Grid>
                      <ui:ProgressBar
                        Grid.Row="1"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Margin="0,2,2,2"
                        Value="{Binding FirmwareUpdateProgress, Mode=OneWay}" />
                    </ikw:SimpleStackPanel>
                  </Border>
                </ikw:SimpleStackPanel>
              </Expander.Content>
            </Expander>
          </Border>

          <!--  PID 调参  -->
          <Border
            Margin="0,2,0,0"
            BorderBrush="#33000000"
            BorderThickness="1"
            CornerRadius="4">
            <Expander Margin="4,0,0,0" HorizontalAlignment="Stretch" ExpandDirection="Down">
              <Expander.Header>
                <Label Content="PID调参:" FontSize="20" />
              </Expander.Header>
              <Expander.Content>
                <ikw:SimpleStackPanel Margin="8,0,2,0" IsEnabled="True">
                  <Grid Margin="0,0,0,2">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                      Grid.Column="0"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"
                      Text="PID设置:" />
                    <ui:ToggleSplitButton
                      Grid.Column="1"
                      HorizontalAlignment="Stretch"
                      IsChecked="{Binding IsEnablePIDDebug}"
                      ToolTip="开启/关闭PID调参">
                      <ui:ToggleSplitButton.Style>
                        <Style TargetType="ui:ToggleSplitButton">
                          <Style.Triggers>
                            <DataTrigger Binding="{Binding IsEnableAtuoPID}" Value="True">
                              <Setter Property="Content" Value="自动赋值" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsEnableAtuoPID}" Value="False">
                              <Setter Property="Content" Value="手动赋值" />
                            </DataTrigger>
                          </Style.Triggers>
                        </Style>
                      </ui:ToggleSplitButton.Style>
                      <ui:ToggleSplitButton.Flyout>
                        <ui:MenuFlyout Placement="BottomEdgeAlignedRight">
                          <MenuItem
                            Command="{Binding SetPIDAutoModeCommand}"
                            CommandParameter="True"
                            Header="自动赋值"
                            ToolTip="当PID数值发生改变时自动向设备发送数据" />
                          <MenuItem
                            Command="{Binding SetPIDAutoModeCommand}"
                            CommandParameter="False"
                            Header="手动赋值"
                            ToolTip="只有点击按钮时才会将PID数值发送给设备" />
                        </ui:MenuFlyout>
                      </ui:ToggleSplitButton.Flyout>
                    </ui:ToggleSplitButton>
                  </Grid>

                  <!--  PID信息选择  -->
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                      Grid.Column="0"
                      Margin="0,0,8,0"
                      VerticalAlignment="Center"
                      Text="PID选择:" />
                    <ComboBox
                      Grid.Column="1"
                      Margin="0,0,2,0"
                      HorizontalAlignment="Stretch"
                      SelectedIndex="{Binding SelectedPIDIndex}"
                      ToolTip="选择要调节的 PID 环路/对象">
                      <ComboBoxItem Content="电流环 Id" />
                      <ComboBoxItem Content="电流环 Iq" />
                      <ComboBoxItem Content="速度环" />
                      <ComboBoxItem Content="位置环" />
                    </ComboBox>
                  </Grid>

                  <!--  Kp、Ki、Kd  -->
                  <Grid>
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                      Grid.Row="0"
                      Grid.Column="0"
                      Margin="0,0,4,0"
                      VerticalAlignment="Center"
                      Text="Kp:" />
                    <ui:NumberBox
                      Grid.Row="0"
                      Grid.Column="1"
                      Margin="0,2"
                      HorizontalAlignment="Stretch"
                      SmallChange="1"
                      SpinButtonPlacementMode="Inline"
                      ToolTip="输入 Kp（数字）"
                      Value="0" />

                    <TextBlock
                      Grid.Row="1"
                      Grid.Column="0"
                      Margin="0,0,4,0"
                      VerticalAlignment="Center"
                      Text="Ki :" />
                    <ui:NumberBox
                      Grid.Row="1"
                      Grid.Column="1"
                      HorizontalAlignment="Stretch"
                      SmallChange="1"
                      SpinButtonPlacementMode="Inline"
                      ToolTip="输入 Ki（数字）"
                      Value="0" />

                    <TextBlock
                      Grid.Row="2"
                      Grid.Column="0"
                      Margin="0,0,4,0"
                      VerticalAlignment="Center"
                      Text="Kd:" />
                    <ui:NumberBox
                      Grid.Row="2"
                      Grid.Column="1"
                      Margin="0,2,0,2"
                      HorizontalAlignment="Stretch"
                      SmallChange="1"
                      SpinButtonPlacementMode="Inline"
                      ToolTip="输入 Kd（数字）"
                      Value="0" />
                  </Grid>
                </ikw:SimpleStackPanel>
              </Expander.Content>
            </Expander>
          </Border>

          <!--  设备信息  -->
          <Border
            Margin="0,2,0,0"
            BorderBrush="#33000000"
            BorderThickness="1"
            CornerRadius="4">
            <Expander
              Margin="4,0,0,0"
              HorizontalAlignment="Stretch"
              ExpandDirection="Down"
              IsExpanded="True">
              <Expander.Header>
                <Label Content="设备信息:" FontSize="20" />
              </Expander.Header>
              <Expander.Content>
                <ikw:SimpleStackPanel Margin="4,0,2,0">
                  <!--  自动更新设置  -->
                  <Border
                    Padding="1"
                    BorderBrush="#33000000"
                    BorderThickness="1"
                    CornerRadius="4">
                    <Grid Margin="4,0,0,0">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                      </Grid.ColumnDefinitions>
                      <TextBlock
                        Grid.Column="0"
                        Margin="0,0,8,0"
                        VerticalAlignment="Center"
                        Text="更新周期:" />
                      <ui:NumberBox
                        Grid.Column="1"
                        HorizontalAlignment="Stretch"
                        PlaceholderText="单位:ms"
                        Value="1000" />
                      <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="ms" />
                      <ToggleButton Grid.Column="3" Margin="2,0,0,0" Content="开启" />
                    </Grid>
                  </Border>

                  <!--  设备信息  -->
                  <Border
                    Margin="0,2,0,0"
                    Padding="1"
                    BorderBrush="#33000000"
                    BorderThickness="1"
                    CornerRadius="4">
                    <ikw:SimpleStackPanel>
                      <Border
                        Margin="0,0,0,1"
                        Padding="1"
                        BorderBrush="#33000000"
                        BorderThickness="1"
                        CornerRadius="4">
                        <Grid Margin="4,0,0,0">
                          <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                          </Grid.ColumnDefinitions>
                          <TextBlock Grid.Column="0" VerticalAlignment="Center" Text="电阻:" />
                          <TextBlock
                            Grid.Column="1"
                            Margin="8,0,8,0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center"
                            Text="0.000000" />
                          <Button Grid.Column="2" Content="更新" />
                        </Grid>
                      </Border>
                      <Border
                        Margin="0,0,0,1"
                        Padding="1"
                        BorderBrush="#33000000"
                        BorderThickness="1"
                        CornerRadius="4">
                        <Grid Margin="4,0,0,0">
                          <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                          </Grid.ColumnDefinitions>
                          <TextBlock Grid.Column="0" VerticalAlignment="Center" Text="电感:" />
                          <TextBlock
                            Grid.Column="1"
                            Margin="8,0,8,0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center"
                            Text="0.000000" />
                          <Button Grid.Column="2" Content="更新" />
                        </Grid>
                      </Border>
                    </ikw:SimpleStackPanel>
                  </Border>

                  <!--  添加信息按钮  -->
                  <Button Margin="0,4,0,2" HorizontalAlignment="Stretch" Content="添加信息" />
                </ikw:SimpleStackPanel>
              </Expander.Content>
            </Expander>
          </Border>
        </ikw:SimpleStackPanel>
      </ScrollViewer>

      <!--  左右分隔条  -->
      <GridSplitter
        Grid.Column="1"
        Width="3"
        HorizontalAlignment="Stretch"
        VerticalAlignment="Stretch"
        Background="#22000000"
        ResizeDirection="Columns"
        ShowsPreview="False" />

      <!--  右侧图表区  -->
      <Grid Grid.Column="2" Margin="4">
        <Grid.RowDefinitions>
          <RowDefinition Height="{Binding ChartRowHeight, Mode=TwoWay}" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="{Binding OutputRowHeight, Mode=TwoWay}" />
        </Grid.RowDefinitions>
        <!--  折线图区域  -->
        <Border
          Grid.Row="0"
          BorderBrush="#33000000"
          BorderThickness="1"
          CornerRadius="4">
          <Expander Margin="2,0,2,2" ExpandDirection="Down" IsExpanded="{Binding IsChartExpanded}">
            <Expander.Header>
              <Label Content="画图区:" FontSize="20" />
            </Expander.Header>
            <Expander.Content>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <!--  图表控制区  -->
                <Border
                  Grid.Column="1"
                  BorderBrush="#33000000"
                  BorderThickness="1"
                  CornerRadius="2">
                  <Expander Margin="2" ExpandDirection="Left" IsExpanded="False">
                    <Expander.Header>
                      <TextBlock FontSize="16" Text="{Binding ChartControlHeader, Mode=OneTime}" />
                    </Expander.Header>
                    <Expander.Content>
                      <ScrollViewer Margin="4,0,0,0">
                        <ikw:SimpleStackPanel>
                          <CheckBox Content="电流Iq" />
                          <CheckBox Content="电流Id" />
                          <CheckBox Content="速度" />
                          <CheckBox Content="位置" />
                        </ikw:SimpleStackPanel>
                      </ScrollViewer>
                    </Expander.Content>
                  </Expander>
                </Border>

                <!--  折线图画布  -->
                <Border
                  Grid.Column="0"
                  BorderBrush="#33000000"
                  BorderThickness="1"
                  CornerRadius="2">
                  <lvc:CartesianChart />
                </Border>
              </Grid>
            </Expander.Content>
          </Expander>
        </Border>

        <!--  上下分隔条  -->
        <GridSplitter
          Grid.Row="1"
          Height="3"
          Margin="0,2,0,0"
          Background="#22000000"
          ResizeDirection="Rows"
          ShowsPreview="False" />

        <!--  输出字符命令行  -->
        <Border
          Grid.Row="2"
          Margin="0,2,0,0"
          Padding="1"
          BorderBrush="#33000000"
          BorderThickness="1"
          CornerRadius="4">
          <Expander Margin="2,0,2,0" ExpandDirection="Down" IsExpanded="{Binding IsOutputExpanded}">
            <Expander.Header>
              <Label Content="输出区:" FontSize="20" />
            </Expander.Header>
            <Expander.Content>
              <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="*" />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <!--  字符输出区  -->
                <TextBox
                  Grid.Row="0"
                  MinHeight="150"
                  VerticalAlignment="Stretch"
                  ui:ControlHelper.CornerRadius="0"
                  FontSize="14"
                  IsReadOnly="True"
                  Text="该上位机适用YXS-FOC的调试"
                  VerticalScrollBarVisibility="Auto" />

                <!--  字符发送区  -->
                <Grid Grid.Row="1">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>
                  <TextBox Grid.Column="0" HorizontalAlignment="Stretch" FontSize="14" />
                  <Button
                    Grid.Column="1"
                    Width="80"
                    VerticalAlignment="Stretch"
                    Content="发送" />
                </Grid>
              </Grid>
            </Expander.Content>
          </Expander>
        </Border>
      </Grid>
    </Grid>

    <!--  状态栏  -->
    <StatusBar Grid.Row="1">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!--  左侧：固件版本等信息  -->
        <StackPanel Grid.Column="0" Margin="8,0,0,0" Orientation="Horizontal">
          <Label Content="状态: " Foreground="Gray" />
          <Label Margin="2,0,0,0" Content="未连接" />
        </StackPanel>

        <!--  右侧：发送/接收帧计数  -->
        <StackPanel Grid.Column="1" Margin="0,0,8,0" Orientation="Horizontal">
          <Label Content="Tx: " Foreground="Gray" />
          <Label Margin="4,0,16,0" Content="0" />
          <Label Content="Rx: " Foreground="Gray" />
          <Label Margin="4,0,0,0" Content="0" />
        </StackPanel>
      </Grid>
    </StatusBar>
  </Grid>
</UserControl>
