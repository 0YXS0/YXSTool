<Window
  x:Class="YXSTool.View.MainWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:i="http://schemas.xaml/behaviors"
  xmlns:ikw="http://schemas.inkore.net/lib/ui/wpf"
  xmlns:local="clr-namespace:YXSTool.View"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
  xmlns:vm="clr-namespace:YXSTool.ViewModel"
  Title="YXSTool"
  Width="1024"
  Height="720"
  d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"
  ui:TitleBar.Height="0"
  ui:WindowHelper.SystemBackdropType="Mica"
  ui:WindowHelper.UseModernWindowStyle="True"
  WindowStartupLocation="CenterScreen"
  WindowStyle="None"
  mc:Ignorable="d">
  <Window.Resources>
    <Style x:Key="CustomTabControlStyle" TargetType="TabControl">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="TabControl">
            <Grid ClipToBounds="True" KeyboardNavigation.TabNavigation="Local">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" MinHeight="32" />
                <RowDefinition Height="*" />
              </Grid.RowDefinitions>

              <!--  标签栏容器  -->
              <Grid Grid.Row="0" Background="{TemplateBinding Background}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  TabPanel - 显示所有标签  -->
                <TabPanel
                  Grid.Column="0"
                  Panel.ZIndex="1"
                  IsItemsHost="True"
                  KeyboardNavigation.TabIndex="1"
                  KeyboardNavigation.TabNavigation="Local" />

                <!--  Add 按钮 - 紧挨着标签  -->
                <ui:TitleBarButton Grid.Column="1" HorizontalAlignment="Left">
                  <ui:TitleBarButton.Content>
                    <ui:FontIcon FontSize="14" Icon="{x:Static ui:SegoeFluentIcons.Add}" />
                  </ui:TitleBarButton.Content>
                  <ui:FlyoutService.Flyout>
                    <ui:MenuFlyout Placement="BottomEdgeAlignedLeft">
                      <MenuItem Command="{Binding AddTabItemCommand}" CommandParameter="FocTool" Header="FocTool" />
                    </ui:MenuFlyout>
                  </ui:FlyoutService.Flyout>
                </ui:TitleBarButton>

                <!--  右侧按钮容器  -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Right" Orientation="Horizontal">
                  <ui:TitleBarButton Command="{Binding MinimizeCommand}">
                    <ui:TitleBarButton.Content>
                      <ui:FontIcon FontSize="12" Icon="{x:Static ui:SegoeFluentIcons.ChromeMinimize}" />
                    </ui:TitleBarButton.Content>
                  </ui:TitleBarButton>
                  <ui:TitleBarButton Command="{Binding CloseCommand}">
                    <ui:TitleBarButton.Content>
                      <ui:FontIcon FontSize="12" Icon="{x:Static ui:SegoeFluentIcons.ChromeClose}" />
                    </ui:TitleBarButton.Content>
                  </ui:TitleBarButton>
                </StackPanel>
              </Grid>

              <!--  内容区域  -->
              <ContentPresenter
                Name="PART_SelectedContentHost"
                Grid.Row="1"
                Margin="{TemplateBinding Padding}"
                ContentSource="SelectedContent" />
            </Grid>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="CloseTabItemStyle" TargetType="TabItem">
      <Setter Property="HeaderTemplate">
        <Setter.Value>
          <DataTemplate>
            <Border Margin="4,8,4,4" CornerRadius="4">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Border Grid.Column="0" Margin="0,0,6,0">
                  <ui:FontIcon Icon="{Binding DataContext.Icon, RelativeSource={RelativeSource AncestorType=TabItem}}" />
                </Border>
                <ContentPresenter Grid.Column="1" VerticalAlignment="Center" Content="{Binding}" />
                <Button
                  Grid.Column="2"
                  Margin="6,0,0,0"
                  Padding="4"
                  VerticalAlignment="Center"
                  Background="Transparent"
                  BorderThickness="0"
                  Command="{Binding DataContext.RemoveTabItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                  CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=TabItem}}">
                  <Button.Content>
                    <ui:FontIcon FontSize="10" Icon="{x:Static ui:SegoeFluentIcons.ChromeClose}" />
                  </Button.Content>
                </Button>
              </Grid>
            </Border>
          </DataTemplate>
        </Setter.Value>
      </Setter>
    </Style>
  </Window.Resources>

  <TabControl
    ItemContainerStyle="{StaticResource CloseTabItemStyle}"
    ItemsSource="{Binding TabItems}"
    MouseDoubleClick="TabControl_MouseDoubleClick"
    MouseMove="TabControl_MouseMove"
    SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}"
    Style="{StaticResource CustomTabControlStyle}" />
</Window>
